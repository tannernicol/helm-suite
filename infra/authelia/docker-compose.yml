services:
  authelia:
    image: authelia/authelia:4.38
    container_name: authelia
    volumes:
      - ./config:/config
    environment:
      - TZ=${TIMEZONE:-America/Los_Angeles}
      - AUTHELIA_JWT_SECRET=${AUTHELIA_JWT_SECRET}
      - AUTHELIA_SESSION_SECRET=${AUTHELIA_SESSION_SECRET}
      - AUTHELIA_STORAGE_ENCRYPTION_KEY=${AUTHELIA_STORAGE_ENCRYPTION_KEY}
    ports:
      - "127.0.0.1:${AUTHELIA_PORT:-9091}:9091"
    depends_on:
      - redis
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: authelia-redis
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    restart: unless-stopped

volumes:
  redis-data:
